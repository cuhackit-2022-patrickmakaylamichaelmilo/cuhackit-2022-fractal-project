<!DOCTYPE html>
<head>
    <title>Create a flame fractal!</title>
    <link rel="stylesheet" href="./static/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="./static/FractalSiteFavicon.png">
    
</head>
<body>
    <h1>Create a fractal!</h1>
    
    <div class="row">
        <div class="column">
            <div class="slidercontainer">
                <p>Choose a fractal type:</p>
                <select class="reRenders" name="Fractals" id="fractal-select" style="background-color: (--backgroundColor);">
                    <!-- <option value="">--Please choose an option--</option> -->
                    <option value="linearVariation">Linear Variation</option>
                    <option value="sineVariation">Sin Variation</option>
                    <option value="sphericalVariation">Spherical Variation</option>
                    <option value="horseshoeVariation">Horseshoe Variation</option>
                    <option value="crossVariation">Cross Variation</option>
                    <option value="tangentVariation">Tangent Variation</option>
                </select>
                
                <p>Iterative X Translation (0.0-1.0)</p>
                <input type="range" min="1" max = "100" value ="50" class="slider reRenders" id="parameterA">

                <p>Iterative Y Translation (0.0-1.0)</p>
                <input type="range" min="1" max = "100" value ="50" class="slider reRenders" id="parameterB">

                <p>Transformation (0.0-1.0)</p>
                <input type="range" min="1" max = "100" value ="50" class="slider reRenders" id="parameterC">

                <p>Click or tap to change colors!</p>
                <div>
                    <input type="color" id="colorOne" name="colorOne" class="reRenders"
                           value="#F56600">
                    <label for="colorOne">Color 1</label>
                    
                    <input type="color" id="colorTwo" name="colorTwo" class="reRenders"
                           value="#522D80">
                    <label for="head">Color 2</label>
                </div>
            </div>
        </div>

        <div class="column">
            <img id="image" style="display: none; height: 500px;">
        </div>
    </div>

    <p style="text-align: center;">Created at CUHackit 2022 - <img src="./static/FractalSiteFavicon.png" height="35px" style="vertical-align: middle;"> </p>
    <p style="text-align: center;">Michael Byrd, Makayla Moster, Patrick Smathers, Milo Weinberg</p>

    <script>
        window.fractalConfig = {
            colorA: [245, 102, 0],
            colorB: [82, 45, 128],
            parameterA: 0.5,
            parameterB: 0.5,
            parameterC: 0.5,
            fractalType: "linearVariation"
        }

        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return [
                parseInt(result[1], 16),
                parseInt(result[2], 16),
                parseInt(result[3], 16),
            ];
        }

        function startRender() {
            window.fractalConfig.parameterA = (document.getElementById("parameterA").value / 100);
            window.fractalConfig.parameterB = (document.getElementById("parameterB").value / 100);
            window.fractalConfig.parameterC = (document.getElementById("parameterC").value / 100);
            window.fractalConfig.fractalType = (document.getElementById("fractal-select").value);
            window.fractalConfig.colorA = hexToRgb(document.getElementById("colorOne").value);
            window.fractalConfig.colorB = hexToRgb(document.getElementById("colorTwo").value);
            
            fetch('/fractal', {
                method: "POST",
                body: JSON.stringify(window.fractalConfig),
                headers: {"Content-Type": "application/json"}
            })
                .then(response => response.blob())
                .then(imageBlob => {
                    const imageObjectURL = URL.createObjectURL(imageBlob);
                    var fractalImage = document.getElementById("image");
                    fractalImage.src = imageObjectURL;
                    fractalImage.style.display = "block";
                })
                .catch(e => {
                    console.log(e);
                });
        }

        window.addEventListener("load", () => {
            // go through each element that has reRenders class and add event listener
            // so that it will update automagically when you change something
            for (let elem of document.getElementsByClassName("reRenders")) {
                elem.addEventListener("change", startRender);
                // elem.addEventListener("pointerUp", startRender);
            }
        
            startRender();
        });
    </script>
</body>
